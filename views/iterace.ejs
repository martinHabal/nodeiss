<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    /* Styly pro rozvrh */
    table {
      /* border-collapse: collapse; */
      width: 100%;
    }

    th,
    td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
      cursor: pointer;
      border-radius: 5px;
    }

    th {
      background-color: #f2f2f2;
    }

    /* dialog */
    .dialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
    }


    /* checkbox */
    /* Skryjeme výchozí vzhled checkboxu */
    input[type="checkbox"] {
      margin: 0
    }
  </style>

</head>

<body>
  <button><a href="/">home</a></button>

  <script>
    // Získání aktuálního data
    const currentDate = new Date();

    // Získání roku, měsíce a dne
    const currentYear = currentDate.getFullYear();
    const currentMonth = currentDate.getMonth() + 1; // Měsíce jsou indexovány od 0 (leden) do 11 (prosinec)
    const currentDay = currentDate.getDate();

    // Zobrazení aktuálního roku, měsíce a dne
    console.log(`Aktuální rok: ${currentYear}`);
    console.log(`Aktuální měsíc: ${currentMonth}`);
    console.log(`Aktuální den: ${currentDay}`);

    // Získání prvního dne měsíce následujícího měsíce
    const firstDayOfNextMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);

    // Posun na poslední den aktuálního měsíce
    firstDayOfNextMonth.setDate(firstDayOfNextMonth.getDate() - 1);

    // Získání počtu dní v aktuálním měsíci
    const numberOfDaysInMonth = firstDayOfNextMonth.getDate();
  </script>
  <h3>
    <% const currentDate=new Date(); %>
    <% const currentYear=currentDate.getFullYear(); %>
    <% const currentMonth=currentDate.getMonth() + 1; %>
    <% const currentDay=currentDate.getDate(); %>

    <% const firstDayOfNextMonth=new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                            %>
    <% firstDayOfNextMonth.setDate(firstDayOfNextMonth.getDate() - 1); %>
    <% const numberOfDaysInMonth=firstDayOfNextMonth.getDate(); %>

    <% const daysOfWeek=['Neděle', 'Pondělí' , 'Úterý' , 'Středa' , 'Čtvrtek' , 'Pátek'
                                        , 'Sobota' ]; %>
    <% const dayOfWeekNumber=currentDate.getDay();%>
    <% const dayOfWeekName=daysOfWeek[dayOfWeekNumber];%>

    <%= currentDay + ". " + currentMonth + ". " + currentYear
                                                    + " a tento měsíc má " + numberOfDaysInMonth + " dní" + " dnes je "
                                                    + dayOfWeekName %>
  </h3>


  <h1>
    iterace
  </h1>
  <% day="Pondělí" %>
  <% hour=0 %>
  <% date=1 %>
  <table>
    <tr>
      <th></th>
      <th></th>
      <th>0(07:00 - 07:45)</th>
      <th>1(08:00 - 08:45)</th>
      <th>2(08:55 - 09:40)</th>
      <th>3(09:50 - 10:35)</th>
      <th>4(10:55 - 11:40)</th>
      <th>5(11:50 - 12:35)</th>
      <th>6(12:45 - 13:30)</th>
      <th>7(13:40 - 14:25)</th>
      <th>8(14:30 - 15:15)</th>
      <th>9(15:20 - 16:05)</th>
      <th>10(16:10 - 18:00)</th>

    </tr>

    <tr>

      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <% results.forEach((item, index)=> {%>

      <% if(index===11 || index===66 || index===121 || index===176 || index===231) {%>
      <%day="Úterý" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%} else if(index===22 || index===77 || index===132 || index===187 || index===242) {%>
      <%day="Středa" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%} else if(index===33 || index===88 || index===143 || index===196 || index===253) {%>
      <%day="Čtvrtek" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%}else if(index===44 || index===99 || index===154 || index===207 || index===264) {%>
      <%day="Pátek" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%}else if(index===55 || index==110 || index===165 || index===218 || index===275) {%>
      <%day="Sobota" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%day="Neděle" %>
    </tr>
    <tr>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
    </tr>
    <tr>
      <%day="Pondělí" %>
      <td>
        <%=date%>
        <% date++ %>
      </td>
      <td>
        <%=day%>
      </td>
      <%}else if(index > 205) {%>


      <%}%>
<% color = "transparent" %>

      <% if(item.overtime === 1) {color="red"}
 else if(item.substit === 1) {color="yellow"}
 else if(item.dropped === 1) {color="grey"}
 else if(item.doctor === 1) {color="blue"} %>

      <td style="background-color: <%= color%>" id="<%= item.id %>" day="<%= item.day %>" hour="<%= item.hour %>" onclick=change(event)>
        <%=item.class%>
        <!-- <input type="checkbox" id="myCheckbox">
        <input type="checkbox" id="myCheckbox">
        <input type="checkbox" id="myCheckbox">
        <input type="checkbox" id="myCheckbox"> -->
      </td>

      <%})%>
    </tr>
  </table>
  <script>
    //naveseni eventhandleru na right click
    const tdElements = document.querySelectorAll("td");
    tdElements.forEach((td) => {

      td.addEventListener('contextmenu', function(ev) {
        ev.preventDefault();
        dialog.style.display = "block"; // Zobrazíme dialog
        return false;
      }, false);
    })
    //zastaveni probublavani checkboxu
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener("click", function(event) {
        event.stopPropagation(); // Zastaví další šíření události
        // Toto je event handler pro kliknutí na checkbox
      });
    })




    // zmena predmetu
    function change() {
      console.log(event.target)

      let data = prompt("Zadejte předmět")
      if (data) {
        // URL API, kam bude odeslán požadavek
        const apiUrl = '/iteraceupdate';

        // Data, která budou odeslána jako součást požadavku (může být objekt nebo FormData)
        const requestData = {
          id: event.target.id,
          data: data
        };

        // Konfigurace pro POST požadavek
        const requestOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json' // Změňte na 'application/x-www-form-urlencoded', pokud odesíláte FormData
          },
          body: JSON.stringify(requestData) // Změňte na new URLSearchParams(requestData) pro 'application/x-www-form-urlencoded'
        };

        // Odeslání požadavku pomocí funkce fetch
        fetch(apiUrl, requestOptions)
          .then(response => {
            if (!response.ok) {
              throw new Error('Chyba při komunikaci s API.');
            }
            return response.json();
          })
          .then(data => {
            console.log('Úspěšně zpracována odpověď z API:', data);
            // Zde můžete provést další zpracování dat z API
          })
          .catch(error => {
            console.error('Chyba:', error);
            // Zde můžete zpracovat chybu a poskytnout zpětnou vazbu uživateli
          });
        location.reload()
      }
    }
  </script>


  <!-- dialog -->
  <div id="myDialog" class="dialog">
    <h2>Dialog s checkboxem</h2>
    <label for="overtime">Přesčasová</label>
    <input type="checkbox" id="overtime">
    <label for="substit">Suplovaná</label>
    <input type="checkbox" id="substit">
    <label for="dropped">Odpadnutá</label>
    <input type="checkbox" id="dropped">
    <label for="doctor">Lékař</label>
    <input type="checkbox" id="doctor"><br />
    <label for="note">Poznámka</label>
    <input type="text" id="note"><br />
    <button id="saveDialog">Uložit</button>
    <button id="closeDialog">Zavřít dialog</button>

    <button style="background-color: red" id="red">Přesčasová</button>
    <button style="background-color: rgb(255, 247, 0)" id="yellow">Suplovaná</button>
    <button style="background-color: grey" id="grey">Odpadnutá</button>
    <button style="background-color: blue" id="blue">Lékař</button>
  </div>
  <script>
    // Získáme reference na prvky HTML
    const openButton = document.getElementById("closeDialog");
    const dialog = document.getElementById("myDialog");
    const overtime = document.getElementById("overtime");
    const substit = document.getElementById("substit");
    const dropped = document.getElementById("dropped");
    const doctor = document.getElementById("doctor");

    // Přidáme obsluhu události pro tlačítko Otevřít dialog
    openButton.addEventListener("click", () => {
      dialog.style.display = "none"; // Zobrazíme dialog
    });

    // Přidáme obsluhu události pro checkbox
    checkbox.addEventListener("change", () => {
      const label = document.querySelector("label[for='myCheckbox']");
      if (checkbox.checked) {
        label.textContent = "Skrytý text je zobrazen.";
      } else {
        label.textContent = "Zobrazit text";
      }
    });
  </script>
  <h2>Legenda</h2>
  <p>Bílé pole je základní hodina definována podle rozvrhu konkrétním předmětem v konkrétní třídě.</p>
  <p>Žluté pole je suplovaná nebo přesunutá hodina, vložená do volného pole, kde podle rozvrhu neprobíhala žádná výuka.</p>
  <p>Šedé pole je odpadlá nebo přesouvaná hodina, vyjmutá z plného pole, kde podle rozvrhu měla probíhat řádná výuka, avšak došlo k jejímu odpadnutí nebo přesunutí.</p>
  <p>Modré pole znamená, že hodina odpadlá s náhradou mzdy.(lékař)</p>
</body>

</html>
<!-- chybi mi na konci break, kdyz by bylo vic dat, ale tech vic stejne nemuze byt ale je to osetreni, a ten kod samozrejme musim zkratit -->